local vocs = {
  guren = 1,
  itachi = 2,  
  minato = 3,
}

CONFIG = {
  [vocs.guren] = {
    COMBO = {
      {text = 'shouton suishouheki hachi', cooldown = 2.5},
      {text = 'shouton hashou kouryu', cooldown = 4.1},
      {text = 'shouton suishou meikyu', cooldown = 2.5},
      {text = 'shouton kesshou seichou', cooldown = 2.0},
      {text = 'shouton omiwatari no jutsu', cooldown = 2.5},
      {text = 'shouton kouryu rou', cooldown = 3.1},
      {text = 'shouton kesshou kouryu', cooldown = 2.5},
    },
    BUFF = {
      {text = 'shouton shishou'},
    },
  },

  [vocs.itachi] = {
    COMBO = {
      {text = 'suiton houmatsu no jutsu', cooldown = 3.5},
      {text = 'suiton bakusui shouha', cooldown = 5.1},
      {text = 'shabondama taiga', cooldown = 3.1},
      {text = 'kibakuhou shabondama', cooldown = 2.5},
      {text = 'shabondama no jutsu', cooldown = 2.5},
      {text = 'santouka no jutsu', cooldown = 1.5},
    },
    BUFF = {
      {text = 'baburukei'},
    },
  },

  [vocs.minato] = {
    COMBO = {
      {text = 'ransenshuriken', cooldown = 3.5},
    },
    BUFF = {
      {text = 'baburukei'},
    },
  },
}

local currentConfig = nil
addIcon("Combo", {item={id=3292 , count=1}, text="Combo"}, macro(50, function()
  if not currentConfig then return end
  local target = g_game.getAttackingCreature()
  if not g_game.isAttacking() or stopCombo and stopCombo >= now then return end
  for index, value in ipairs(currentConfig.COMBO) do
    if (not value.cooldown or value.cooldown <= now) then
      say(value.text)
    end
  end
end))

onTalk(function(name, level, mode, text, channelId, pos)
  if not currentConfig then return end
  if name ~= player:getName() then return end
  text = text:lower();
  for index, value in ipairs(currentConfig.COMBO) do
    if text == value.text:lower() then
      value.cooldown = now + (value.cooldown * 1000);
      break
    end
  end
end) 

onTextMessage(function(mode, text)
  if not text:find("mesmo.") then return end
  for voc, id in pairs(vocs) do
    if text:find(voc) then
      currentConfig = CONFIG[id]
      break
    end
  end
end)

schedule(500, function()
  g_game.look(player)
end)
